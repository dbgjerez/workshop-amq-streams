<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kafka Topic :: Workshop AMQ Streams</title>
    <link rel="canonical" href="https://github.com/dbgjerez/workshop-amq-streams/workshop-amq-streams/04-topic.html">
    <link rel="prev" href="03-cluster.html">
    <link rel="next" href="05-user.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="https://github.com/dbgjerez/workshop-amq-streams">Workshop AMQ Streams</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Books</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">CheatSheets</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">CheatSheet A</a>
            <a class="navbar-item" href="#">CheatSheet B</a>
            <a class="navbar-item" href="#">CheatSheet C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Upcoming Events</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Event A</a>
            <a class="navbar-item" href="#">Event B</a>
            <a class="navbar-item" href="#">Event C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Tutorial A</a>
            <a class="navbar-item" href="#">Tutorial B</a>
            <a class="navbar-item" href="#">Tutorial C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="workshop-amq-streams" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">AMQ Streams</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-introduction.html">1. Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-introduction.html#architecture">Architecture</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-operator.html">2. Operator</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-operator.html#installation">Installation</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="03-cluster.html">3. Kafka Cluster</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="04-topic.html">4. Kafka Topic</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="05-user.html">5. Kafka User</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-data.html">6. Data streaming</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-data.html#producersandconsumers">Producers and consumers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-data.html#simple">Simple data</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-data.html#sendsimpledata">Send plain text</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-data.html#receivesimpledata">Receive plain text</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="06-data.html#json">JSON</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-data.html#sendjson">Send JSON</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="06-data.html#receivejson">Receive JSON</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="06-data.html#avro">Avro scheme</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="07-monitoring.html">7. Monitoring</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="08-security.html">8. Security</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">AMQ Streams</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">AMQ Streams</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="index.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">AMQ Streams</a></li>
    <li><a href="04-topic.html">4. Kafka Topic</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/dbgjerez/workshop-amq-streams/edit/master/doc-gh-pages/documentation/modules/ROOT/pages/04-topic.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Kafka Topic</h1>
<div class="paragraph">
<p>These labs pretend to introduce about the topic concept in Kafka.</p>
</div>
<div class="paragraph">
<p>Prerequisites:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AMQ Streams operator installed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Goals:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Kafka topic concepts</p>
</li>
<li>
<p>How to create a topic</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Kafka cluster</strong> works as a group of <strong>brokers</strong>.</p>
</div>
<div class="paragraph">
<p>The data is stored in <strong>Topics</strong>. Each topic has one or many partitions where the data is distributed.</p>
</div>
<div class="paragraph">
<p>A <strong>partition</strong> has a data subset of the topic. Thanks to this, the data processing can be parallelized.</p>
</div>
<div class="paragraph">
<p>Another important point is the <strong>replication factor</strong>. When a topic is divided in partitions, we earn the ability of parallelization, but we need high availability in most cases. With the replication factor, we indicate to Kafka how many times this partition should be replicated along the brokers. These replications are not productive, they are followers of the main that only work in case of fail in the partition leader.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/kafka-concepts-key-concepts.png" alt="How to Kafka operate">
</div>
</div>
<div class="paragraph">
<p>To deploy a topic we have to apply a <strong>KafkaTopic</strong> descriptor. The descriptor shows like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: kafka.strimzi.io/v1beta2
kind: KafkaTopic
metadata:
  name: simple-topic-demo
  labels:
    strimzi.io/cluster: kafka-cluster-demo
spec:
  config:
    # 60m * 60s * 1000ms = 1h
    retention.ms: 3600000
    # 1gb
    segment.bytes: 1073741824
  partitions: 1
  replicas: 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see a lot of important configuration points:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>config.retention.ms:</strong> represents the time before the data is deleted</p>
</li>
<li>
<p><strong>config.segment.bytes:</strong> controls the segment file size for the log</p>
</li>
<li>
<p><strong>partitions:</strong> number of partitions of the topic</p>
</li>
<li>
<p><strong>replicas:</strong> number of replicas in each partition</p>
</li>
<li>
<p><strong>topicName:</strong> name of the topic when the client connects inside the cluster</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To deploy the topic is needed a cluster. We&#8217;re going to reuse the cluster used to explain the Kafka clusters.</p>
</div>
<div class="paragraph">
<p>We recreate it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f content/components/kafka-cluster/kafka-cluster-demo.yaml -n $OCP_NS</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can wait while the operator is starting up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get kafka -w
NAME                 DESIRED KAFKA REPLICAS   DESIRED ZK REPLICAS   READY   WARNINGS
kafka-cluster-demo   3                        3
kafka-cluster-demo   3                        3                     True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, once the cluster is up, we can deploy the topic:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc apply -f content/components/kafka-topic/kafka-simple-topic.yaml -n $OCP_NS</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can ask for it with the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get kafkatopic -n $OCP_NS simple-topic-demo
NAME                CLUSTER              PARTITIONS   REPLICATION FACTOR   READY
simple-topic-demo   kafka-cluster-demo   1            2                    True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, the topic is ready to receive and send the data.</p>
</div>
<div class="paragraph">
<p>If we enter inside a Kafka broker container, we can navigate to the filesystem when the topic is created and his data is stored.</p>
</div>
<div class="paragraph">
<p>To list the brokers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get po -n $OCP_NS | grep demo-kafka | awk '{print $1}'
kafka-cluster-demo-kafka-0
kafka-cluster-demo-kafka-1
kafka-cluster-demo-kafka-2</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enter inside and list the filesystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc exec -it -n $OCP_NS kafka-cluster-demo-kafka-0 ls /var/lib/kafka/data/kafka-log0/</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we indicated the replica value=2 and the partition=1, we can see the topic only in 2 brokers.</p>
</div>
<div class="paragraph">
<p>At this point, we have examined the topic and we don&#8217;t need it, so we can delete it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete kafkatopic simple-topic-demo -n $OCP_NS
kafkatopic.kafka.strimzi.io "simple-topic-demo" deleted</code></pre>
</div>
</div>
<div class="paragraph">
<p>And also the cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc delete kafka kafka-cluster-demo -n $OCP_NS
kafka.kafka.strimzi.io "kafka-cluster-demo" deleted</code></pre>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="03-cluster.html" class="query-params-link">3. Kafka Cluster</a></span>
  <span class="next"><a href="05-user.html" class="query-params-link">5. Kafka User</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../_/js/vendor/clipboard.js"></script>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
